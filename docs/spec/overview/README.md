# 全体的な仕様

## 未定義部分

- 参加者が現在いるスポットの判定方法
  - スポットに入った、出たの判定基準
- データ
  - イベントログとは・仕組み・定義
- 利用規約的な
  - アカウント削除時のデータの扱い

## 旧仕様書の補足

### モバイルの要件

- イベント参加者向け

  - イベント参加 QR スキャン
    URL からパラメータのイベント ID のみを解釈し、サーバーに送信する。
    内部的にこのタイミングでアカウントが作成される。
    [イベント参加 QR コードの仕様](../system/data.md#LP/イベント参加兼用コード)
  - スポット検知
    ServiceUUID でビーコンを購読して、スポットに入った、出たことを LINE Simple Beacon を使い検出し、サーバーに送信する。
  - ピック用 QR スキャン
    JSON の QR コードを読み込み、サーバーに送信する。
    [ピックスポットのパレット取得 QR コードの仕様](../system/data.md#ピックスポットのパレット取得コード)
  - 画像を表示
    現在の収集状況に応じて、画像を表示する。
    画像はアプリ使用者の意思によって任意のタイミングで保存できる。
    デフォルト画像(複数枚)と撮影した画像(0..1)を選択することができる。
  - 参加者 QR 表示
    参加者識別 QR を表示する。
    [参加者識別 QR コードの仕様](../system/data.md#参加者識別コード)
  - HP などへの導線
    イベント HP や、イベント運営の連絡先などを表示する。
  - 通知
    二つのタイミングで通知を行う。
    - ピック可能なスポットに入ったとき
    - 現在いるスポットから他のスポットへの人流制御が行われたとき
  - アカウントの削除
    任意のタイミングでアカウントを削除できるようにする。
    削除をすると、バッチ処理により event_log に定義されるデータ以の全てのデータが破棄されることが保証される。

- イベント運営向け
  - Auth0 によるログイン
  - 写真撮影
  - ビーコン・スポットの登録

## 旧仕様書より

- mobile
  - 運営
    - スポット管理
      - ビーコンの ID と登録する対象のイベントを投げる
      - ビーコンに名前をつける
      - 登録済みのビーコンの UUID に紐づいている名前の確認
      - ビーコンと QR コードの紐付け確認
    - 写真撮影
      - 撮影した写真と参加者の ID を投げる
      - 撮影した写真を確認、破棄
- web
  - 人流制御
    - 人流の可視化
      - ビーコンごとに人数がどれくらい集まってるか分かる
      - 10 秒間隔でその間に訪れた人数を数字で表示する
        - ビーコンに紐付いた人数の情報をサーバーから取得する
    - スポットごとの拾える量の設定
      - スポット A（例：過密なスポット）からスポット B（例：過疎なスポット）を選んで過疎側の拾える量を変化させる
      - パレットの量が変化した際に一部の人に通知が行く
        - 「一部の人」とは、スポットＡにいるユーザーの一部である
      - 終了タイミングは、B にいる人間が A の n%になるまで、または増加イベントの時間制限がくるまで
  - 認証
    - 運営ユーザーごとにイベントを紐付ける
      - イベントと運営アカウントは一対多で結びつく
      - Auth0 の uuid をサーバーに post する
  - イベント参加用 QR と運営ログイン QR を出す
    - サーバーから帰ってきた画像を表示する
  - イベント作成
    - イベント名の設定
  - 作成したイベントに対しての設定
    - ホームページの URL をサーバーに登録
    - タイムスケジュールをサーバーに登録
    - デフォルトの画像をサーバーに登録
    - メールアドレスをサーバーに登録
  - ビーコン管理
    - スポットに対して QR を発行する
    - スポット一覧を名前と一緒に表示する
  - タイムテーブルに設定されている時間によって通知をする
  - 手動通知ストリーミング
    - ぽっと出のイベントの通知
- server

[エンドポイント](https://docs.google.com/document/u/0/d/1taBjFNSsjwilMK2FhlFNl0VWmqxwDCAl_fy2ugBUgjI/edit)
